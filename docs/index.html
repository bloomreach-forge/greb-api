<!DOCTYPE html>
    <!--
 | Generated by Apache Maven Doxia Site Renderer 2.0.0 at $dateFormat.format( $currentDate ) 
 | Rendered using Bloomreach Forge Maven Skin 3.2.1 based on Apache Maven Fluido Skin
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="" lang="">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                      <meta http-equiv="Content-Language" content="" />
      <title>GREB API â€“ greb-api</title>
  <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-3.2.1.min.css"/>
  <link rel="stylesheet" href="./css/forge-maven-skin-3.2.1.min.css"/>
  <link rel="stylesheet" href="./css/site.css" />
  <link rel="stylesheet" href="./css/print.css" media="print" />
  <link rel="icon" type="image/png" href="./images/skin/logo_64.png" sizes="64x64">

  
  <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-3.2.1.min.js"></script>
  <script type="text/javascript" src="./js/forge-maven-skin-3.2.1.min.js"></script>

            <style>.github-fork-ribbon:before { background-color: green; }</style>
</head>
<body class="topBarDisabled">
              <a target="_blank" class="github-fork-ribbon right" href="https://github.com/bloomreach-forge/greb-api"
     data-ribbon="Fork me on GitHub" title="Fork me on GitHub">Fork me on GitHub</a>
          <div class="container-fluid">
  <div id="banner">
    <div id="logo">
                        <a href="https://bloomreach-forge.github.io">
        <img src="./images/skin/logo.png" alt="Bloomreach Forge Logo" />
      </a>
    </div>
    <div class="pull-left">                    <h1>        Generic Resource Entity Builder
        </h1>            </div>
    <div class="pull-right"></div>
    <div class="clear"><hr/></div>
  </div>

  <div id="breadcrumbs">
                            <div class="links">
      <a href="https://xmdocumentation.bloomreach.com">xmdocumentation.bloomreach.com</a>
      <a href="https://github.com/bloomreach-forge">github.com/bloomreach-forge</a>
    </div>
    <ul class="breadcrumb">
    
  <li id="publishDate">published: $dateValue  
  </li>
  
        
            </ul>
    <div class="clear"><hr/></div>
  </div>
<div class="row-fluid">
  <div id="leftColumn" class="span2">
    <div class="well sidebar-nav">
    
    <ul class="nav nav-list">
            <li class="nav-header">Main</li>
              <li class="active">  <a href="#"><span class="none"></span>Welcome</a>
  </li>
        <li>  <a href="install.html" title="Install">  <span class="none"></span>  Install</a>  </li>
        <li>  <a href="release-notes.html" title="Release Notes">  <span class="none"></span>  Release Notes</a>  </li>
                  <li class="nav-header">Autogenerated Docs</li>
                                                                                                                                                                                                        <li>  <a href="project-info.html" title="Project Information">  <span class="icon-chevron-down"></span>  Project Information</a>  
    <ul class="nav nav-list">
                  <li>  <a href="dependencies.html" title="Dependencies">  <span class="none"></span>  Dependencies</a>  </li>
                        <li>  <a href="dependency-info.html" title="Maven Coordinates">  <span class="none"></span>  Maven Coordinates</a>  </li>
                        <li>  <a href="dependency-management.html" title="Dependency Management">  <span class="none"></span>  Dependency Management</a>  </li>
                        <li>  <a href="distribution-management.html" title="Distribution Management">  <span class="none"></span>  Distribution Management</a>  </li>
                                  <li>  <a href="issue-management.html" title="Issue Management">  <span class="none"></span>  Issue Management</a>  </li>
                        <li>  <a href="licenses.html" title="Licenses">  <span class="none"></span>  Licenses</a>  </li>
                        <li>  <a href="plugin-management.html" title="Plugin Management">  <span class="none"></span>  Plugin Management</a>  </li>
                        <li>  <a href="plugins.html" title="Plugins">  <span class="none"></span>  Plugins</a>  </li>
                        <li>  <a href="scm.html" title="Source Code Management">  <span class="none"></span>  Source Code Management</a>  </li>
                        <li>  <a href="summary.html" title="Summary">  <span class="none"></span>  Summary</a>  </li>
                        <li>  <a href="team.html" title="Team">  <span class="none"></span>  Team</a>  </li>
              </ul>
  </li>
        </ul>
    
          <hr />
      <div id="poweredBy">
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
          <a href="http://maven.apache.org/" title="$i18n.getString( "site-renderer", $locale, "template.builtby" ) Maven" class="poweredBy">  <img class="builtBy" alt="$i18n.getString( "site-renderer", $locale, "template.builtby" ) Maven" src="./images/logos/maven-feather.png" />  </a>
        </div>
    </div>
  </div>
  <div id="bodyColumn"  class="span10" >
    
  

    <section><a id="GREB_API"></a>
<h1>GREB API</h1>

      <section><a id="Introduction"></a>
<h2>Introduction</h2>
        
<p>
          The GREB (Generic Resource Entity Builder) API module enables you to provide a simple,
          flexible JSON data producing application using the standard HstComponent code.
        </p>
        
<div>
          <img src="images/grebe.png" />
        </div>
        
<p>
          (By courtesy of <a href="https://www.flickr.com/photos/ferranp/" class="externalLink">Ferran Pesta&#xf1;a</a>,
          licensed by <a href="https://creativecommons.org/licenses/by-sa/2.0/" class="externalLink">CC BY-SA 2.0</a>)
        </p>
        
<p>
          Suppose you simply want to produce content data in JSON output for any REST API clients
          (single page applicaton or server-side application) quickly in a very flexible way without having to
          be concerned about considering standards such as JAX-RS or any other restricitions. Also, suppose you
          or your colleages already know how to implement standard <code>HstComponent</code>s and retrieve content there and
          so you simply want to implement even RESTful services using the same technology, <code>HstComponent</code>s.
        </p>
        
<p>
          In this case, GREB (Generic Resource Entity Builder) API can be a good technical choice.
        </p>
        
<p>
          Please see <a href="install.html">Install</a> page to install this addon module onto your project.
          Also see the <a href="release-notes.html">Release Notes</a> to find the proper version for your project.
        </p>
      </section>

      <section><a id="What_is_GREB_API.3F"></a>
<h2>What is GREB API?</h2>
        
<p>
          GREB API is simply a new built-in HST-2 <code>Pipeline</code> to do almost the same things as the default HST-2 Site
          <code>Pipeline</code>, except of the following:
        </p>
        
<ul>
          
<li>
            The <code>Pipeline</code> of GREB API consists of the same <code>Valve</code>s, but overrides the
            <code>AggregationValve</code> to produce JSON output instead of the default (HTML) output.
          </li>
          
<li>
            As it doesn't need to aggregate all the output from templates of each <code>HstComponent</code>, it doesn't executes
            all the rendering templates of each <code>HstComponent</code>, After executing <code>#doBeforeRender(HstRequest, HstResponse)</code>
            on each <code>HstComponent</code>, it stops processing and aggregates all the contributed resource entities and to
            produce an aggregated JSON result to client.
          </li>
          
<li>
            Each <code>HstComponent</code> class can (optionally) contribute any resource entity objects by using GREB API in
            its code (e.g, <code>#doBeforeRender(HstRequest, HstResponse)</code>). In the overriden <code>AggregationValve</code>, GREB API
            will collect all the contributed resource entity objects based on the contribution paths and serialize
            the resource entity objects by using Jackson (v2) library.
          </li>
        </ul>
        
<p>Here's an architectural view.</p>
        
<div>
          <img src="images/greb_api_cnc.png" />
        </div>
        
<p>
          Bascially, you need to configure a separate mount (mapped to &quot;hst:root/grebapi&quot;, for example) for GREB API,
          under your default site pipeline (mapped to &quot;hst:root&quot;, for example).
          So the GREB API mount (e.g, &quot;hst:root/grebapi&quot;) will inherit everything from the parent mount (e.g, &quot;hst:root&quot;),
          including sitemap, pages, components, etc.
          So, the GREB API mount and its Pipeline will use the same configuration and the same <code>HstComponent</code>s.
        </p>
        
<p>
          When the GREB API mount is requested by a REST Client (e.g, http://localhost:8080/site/grebapi/a/b/c.html),
          the delivery tier will invoke the same sitemap item, page and components, not templates.
          After invoking <code>#doBeforeRender(HstRequest, HstResponse)</code> on each HstComponent,
          it collects all the contributed resource entity objects from each HstComponent and aggregate the objects
          into a JSON output to the REST Client.
        </p>
      </section>

      <section><a id="How_to_Contribute_Resource_Entity_Objects.3F"></a>
<h2>How to Contribute Resource Entity Objects?</h2>
        
<p>
          You can contribute any objects (POJOs or any JSON-serializable objects by Jackson v2 library)
          in <code>HstComponent</code> code or any other code involved in HST-2 request processing.
        </p>
        
<p>
          If you don't contribute any objects in your code (e.g, <code>HstComponent</code>s),
          the GREB API pipeline will produce an empty JSON object by default:
        </p>
        
<div class="brush: javascript">
        
<pre><code>
{
}
        </code></pre>
        </div>
        
<p>
          To contribute an object, you should get
          <code>com.onehippo.cms7.genericresource.entitybuilder.GenericResourceEntityBuilder</code> instance first:
        </p>
        
<div class="brush: java">
        
<pre><code>
    GenericResourceEntityBuilder builder = GenericResourceEntityBuilder.get(RequestContextProvider.get());
        </code></pre>
        </div>
        
<p>
          You can contribute any scalar values on specific paths like the folloiwng:
        </p>
        
<div class="brush: java">
        
<pre><code>
    builder.addResourceEntity(&quot;title&quot;, document.getTitle());
    builder.addResourceEntity(&quot;timestamp&quot;, System.currentTimeMillis());
        </code></pre>
        </div>
        
<p>
          As two objects were contributed with paths, then the JSON output will look like this:
        </p>
        
<div class="brush: javascript">
        
<pre><code>
{
  &quot;title&quot;: &quot;Hello, World!&quot;,
  &quot;timestamp&quot;: 1479249799770
}
        </code></pre>
        </div>
        
<p>
          You can contribute any POJO or any Java objects that can be serialized to JSON by using Jackson v2 library:
        </p>
        
<div class="brush: java">
        
<pre><code>
    builder.addResourceEntity(&quot;document&quot;, document);
        </code></pre>
        </div>
        
<p>
          Now, the JSON output will look like this:
        </p>
        
<div class="brush: javascript">
        
<pre><code>
{
  &quot;title&quot;: &quot;Hello, World!&quot;,
  &quot;timestamp&quot;: 1479249799770,
  &quot;document&quot;: {
    &quot;title&quot;: &quot;The medusa news&quot;,
    &quot;introduction&quot;: &quot;This is a news article.&quot;,
    // ...
  }
}
        </code></pre>
        </div>
        
<p>
          If a Java object is contributed, then GREB API simply serialize it into JSON using Jackson v2 library.
          Therefore, you should make sure that your Java objects to contribute are serializable in Jackson v2 library.
          Consider using Jackson annotations if you want to exclude some properties or control the serializations.
        </p>
      </section>

      <section><a id="How_to_Contribute_Resource_Entity_Objects_in_a_nested_path.3F"></a>
<h2>How to Contribute Resource Entity Objects in a nested path?</h2>
        
<p>
          You can wrap your resource entity objects in either <code>java.util.Collection</code>
          (such as <code>java.util.List</code> or <code>java.util.Set</code>) or
          <code>java.util.Map</code> like the following example:
        </p>
        
<div class="brush: java">
        
<pre><code>
    List&lt;Object&gt; references = new LinkedList&lt;&gt;();
    references.add(referenceDoc1);
    references.add(referenceDoc2);
    builder.addResourceEntity(&quot;references&quot;, references);

    Map&lt;String, Object&gt; images = new LinkedHashMap&lt;&gt;();
    images.put(&quot;portrait&quot;, portrait);
    images.put(&quot;landscape&quot;, landscape);
    builder.addResourceEntity(&quot;images&quot;, images);
        </code></pre>
        </div>
        
<p>
          Now, the JSON output will look like this:
        </p>
        
<div class="brush: javascript">
        
<pre><code>
{
  &quot;title&quot;: &quot;Hello, World!&quot;,
  &quot;timestamp&quot;: 1479249799770,
  &quot;document&quot;: {
    &quot;title&quot;: &quot;The medusa news&quot;,
    &quot;introduction&quot;: &quot;This is a news article.&quot;,
    // ...
  },
  &quot;references&quot;: [
    {
      &quot;title&quot;: &quot;Referenced Document 1&quot;,
      // ...
    },
    {
      &quot;title&quot;: &quot;Referenced Document 2&quot;,
      // ...
    }
  ],
  &quot;images&quot;: {
    &quot;portrait&quot;: {
      // SNIP
    },
    &quot;landscape&quot;: {
      // SNIP
    }
  }
}
        </code></pre>
        </div>
        
<p>
          You can nest objects as deep as you want through container
          (either <code>java.util.Collection</code> or <code>java.util.Map</code>) objects.
        </p>
        
<p>
          You can also retrieve a resource entity object whether it is a scalar value, object value, collection or map value:
        </p>
        
<div class="brush: java">
        
<pre><code>
    Object value = builder.getResourceEntity(name);
    Collection&lt;Object&gt; collectionValue = builder.getCollectionResourceEntity(name);
    Map&lt;Object&gt; mapValue = builder.getMapResourceEntity(name);
        </code></pre>
        </div>
      </section>

      <section><a id="JSON_Serialization_Support_for_Built-in_HST-2_Objects"></a>
<h2>JSON Serialization Support for Built-in HST-2 Objects</h2>
        
<p>
          GREB API takes care of JSON serialization on built-in HST-2 objects such as:
        </p>
        
<ul>
          
<li>
            Any classes extending <code>HippoBean</code> interface. e.g, HST-2 Content Beans, generated manually
            or through Essentials for each document type, built-in HST-2 Content Beans for images, assets, folders, html, mirror, etc.
          </li>
          
<li>
            HST-2 Site Menu and Menu Item objects.
          </li>
          
<li>
            HST-2 URL objects and HstLink objects.
          </li>
        </ul>
        
<p>
          Therefore, you can contribute objects in those categories directly without having to wrap it to new POJO objects.
        </p>
      </section>

      <section><a id="Custom_Jackson_Mixins_to_Customize_JSON_Serialization"></a>
<h2>Custom Jackson Mixins to Customize JSON Serialization</h2>
        
<p>
          GREB API support customizing JSON serialization on specific beans
          by adding custom <a href="https://github.com/FasterXML/jackson-docs/wiki/JacksonMixInAnnotations" class="externalLink">Jackson Mixins</a>
          for the specific bean types.
        </p>
        
<p>
          In order to register your custom Jackson Mixin classes (or interfaces) with Jackson annotations,
          override the following beans in an Spring Beans assembly overriding XML file under
          <code>site/components/src/resources/META-INF/hst-assembly/overrides/addon/com/onehippo/cms7/genericresource/entitybuilder/</code>
          folder (e.g, <code>my-custom-mixins.xml</code>) like the following example:
        </p>
        
<div class="brush: xml">
        
<pre><code>
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;
       xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
       xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-4.1.xsd&quot;&gt;
 
  &lt;bean id=&quot;genericResourceEntityJacksonObjectMapperExtraMixins&quot;
        class=&quot;org.springframework.beans.factory.config.MapFactoryBean&quot;&gt;
    &lt;property name=&quot;sourceMap&quot;&gt;
      &lt;map&gt;
        &lt;!-- Adding Jackson Mixin class, MyBeanMixin, for MyBean class type. --&gt;
        &lt;entry key=&quot;org.example.beans.MyBean&quot; value=&quot;org.example.beans.jackson.MyBeanMixin&quot; /&gt;
        &lt;!-- SNIP --&gt;
      &lt;/map&gt;
    &lt;/property&gt;
  &lt;/bean&gt;
 
&lt;/beans&gt;
        </code></pre>
        </div>
        
<p>
          This also allows you to override the built-in default Jackson Mixins for built-in types
          (such as <code>HippoGalleryImageSetBean</code>, <code>HippoGalleryImageBean</code>, etc.)
          by your custom Jacksion Mixins.
        </p>
      </section>

    </section>
  

    </div>
    </div>
    </div>
    <hr/>
    <footer>
    <div class="container-fluid">
      <div class="row-fluid">
          <p class="copyright">Copyright &copy;      2017&#x2013;${currentYear}
              <a href="https://www.bloomreach.com">Bloomreach</a>.
          
</p>
    </div>
            </div>
  </footer>
    </body>
</html>

